# =============================================================================
# Required — server will not start or endpoints will fail without these
# =============================================================================

# Postgres connection string (use a read-only database user)
SUPABASE_POSTGRES=postgresql://user:pass@host:port/db?sslmode=require

# DuckDB file path
DUCKDB_FILE=/app/data/your_database.duckdb

# =============================================================================
# Rate limiting & concurrency — adjust to your traffic and server capacity
# =============================================================================

# Per-IP rate limit (SlowAPI format: "N/period" e.g. 30/minute, 60/hour)
RATE_LIMIT=30/minute

# Global rate limit across all IPs combined
GLOBAL_RATE_LIMIT=200/minute

# Max simultaneous in-flight queries per IP
MAX_CONCURRENT_PER_IP=4

# Max simultaneous queries server-wide
MAX_CONCURRENT_GLOBAL=10

# =============================================================================
# Query limits — tune based on your data size and acceptable response times
# =============================================================================

# Query timeout in milliseconds (queries exceeding this are killed)
PG_STATEMENT_TIMEOUT_MS=15000
DUCKDB_QUERY_TIMEOUT_MS=15000

# Max rows returned per query
MAX_JSON_ROWS=1000
MAX_TSV_ROWS=1000

# Max response size in bytes (responses exceeding this return HTTP 413)
MAX_RESPONSE_BYTES=1048576

# =============================================================================
# Postgres connection pool
# =============================================================================

PG_POOL_MIN=3
PG_POOL_MAX=6
PG_POOL_ACQUIRE_TIMEOUT=15

# =============================================================================
# DuckDB resource limits
# =============================================================================

DUCKDB_MEMORY_LIMIT=512MB
DUCKDB_THREADS=2
DUCKDB_TEMP_DIR=/tmp/duckdb
DUCKDB_MAX_TEMP_DIR_SIZE=2GB

# =============================================================================
# CORS & logging
# =============================================================================

CORS_ALLOW_ORIGINS=*
LOG_LEVEL=INFO

# =============================================================================
# Auth0 OAuth (optional — enables /mcp-secure endpoint when AUTH0_DOMAIN is set)
# =============================================================================

AUTH0_DOMAIN=
AUTH0_AUDIENCE=
AUTH0_CLIENT_ID=
AUTH0_CLIENT_SECRET=

# Max failed auth attempts per IP before blocking (default: 5)
AUTH_FAIL_MAX=5

# Failed auth tracking window in seconds (default: 24 hours)
AUTH_FAIL_WINDOW=86400

# =============================================================================
# Optional integrations
# =============================================================================

# API monitoring (optional)
API_MONITOR_URL=
API_MONITOR_KEY=
API_MONITOR_APP_NAME=

# Base URL for MCP (auto-detected from RENDER_EXTERNAL_URL on Render)
RENDER_EXTERNAL_URL=
